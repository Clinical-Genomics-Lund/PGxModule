{% extends "base.html" %}

{% block body %}
<span class="report_header">PGx-analysrapport (NGS) - {{ group }}</span>

<div class="report_div">
  <table class='report_general'> 
    <tr>
      <td class="report_key">Patientnamn</td><td class="report_val">&lt;CLARITY-PATIENT_NAME-CLARITY&gt;</td>
    </tr>
    <tr>
      <td class="report_key">Personnummer</td><td class="report_val">&lt;CLARITY-PERSONAL_NUMBER-CLARITY&gt;</td>
    </tr>
    <tr>
      <td class="report_key">Prov-ID</td><td class="report_val">{{ group }}</td>
    </tr>
    <tr>
      <td class="report_key">Registreringsdatum</td><td class="report_val">&lt;CLARITY-REGISTRATION_DATE-CLARITY&gt;</td>
    </tr>
    <tr>
      <td class="report_key">Provtyp</td><td class="report_val">&lt;CLARITY-SAMPLE_TYPE-CLARITY&gt;</td>
    </tr>
    <tr>
      <td class="report_key">Frågeställning</td><td class="report_val">PGx (DPYD, TMPT, UGT1A1)</td>
    </tr>
    <tr>
      <td class="report_key">Analysmetod</td><td class="report_val">NGS med PGx</td>
    </tr>
    <tr>
      <td class="report_key">Analys genomförd av</td><td class="report_val">Centrum för molekylär diagnostik (CMD) och Klinisk genetik och patologi</td>
    </tr>
    <tr>
      <td class="report_key">Rapportdatum</td><td class="report_val">{{ date }}</td>
    </tr>
</table>
</div>

<div class=report_div style="page-break-inside:avoid;">
  <span class="report_header">Kliniskt relevanta varianter upptäckta</span>
  <table class='variant_table'>
    <tr>
      <th>Gen</th>
      <th>rsID</th>
      <th>Möjliga Haplotyper</th>
      <th>Position</th>
      <th>Zygositet</th>
      <th>Variant frekvens</th>
      <th>Möjlig Duplikation</th>
    </tr>
    {% if clincial_variants is not none %}
      {% for row in clincial_variants %}
        {% if row['Possible Duplication'] == true %}
          <tr style="text-align:left;font-weight: bold;background-color: #FD89B3 !important;" >
        {% else %}
          <tr>
        {% endif %}
          <td>{{ row['Gene'] }}</td>
          <td>{{ row['rsID'] }}</td>
          <td>{{ row['Possible Haplotypes'] }}</td>
          <td>{{ row['Position'] }}</td>
          <td>{{ row['Zygosity'] }}</td>
          <td>{{ row['Variant Frequency'] }}</td>
          <td>{{ row['Possible Duplication'] }}</td>
        </tr>
      {% endfor %}
    {% else %}
      <tr>
        <td colspan="7">Inga detekterade varianter</td>
      </tr>
    {% endif %}
  </table>
</div>

<span class="report_header">Slutsats</span>
<div class="conclusion">
  <div class="results_summary">
  {% if guidelines_warnings|length > 0 %}
    En eller flera varianter som tillhör haplotyp har flagats som osäker.<br> Följ inte rödmarkerade kliniska rekommendationer!
  {% elif clincial_variants is none %}
    Inga kliniskt relevanta varianter hittades.<br> Följ de vanliga riktlinjerna.
  {% elif guidelines_warnings|length == 0 and clincial_variants is not none  %}
    Vissa varianter har upptäckts. <br> Följ den rekommenderade riktlinjen
  {% else %}
    Slutsats saknas!
  {% endif %}
  </div>
</div>

<p style="page-break-before: always;"></p>
<div class=report_div style="page-break-inside:avoid;">
  <span class="report_header">Kliniska rekommendationer baserad på genotyper</span>
  <table class='variant_table'>
    <tr>
      <th>Gen</th>
      <th>Haplotyp 1</th>
      <th>Haplotyp 2</th>
      <th>Klinisk Rekommendation</th>
    </tr>
    {% if guidelines_present is not none %}
      {% for row in guidelines_present %}
        {% if (loop.index -1 ) in guidelines_warnings %}
          <tr style="text-align:left;font-weight: bold;background-color: #FD89B3 !important;">
        {% else %}
          <tr>
        {% endif %}
          <td>{{ row['Gene'] }}</td>
          <td>{{ row['Haplotype 1'] }}</td>
          <td>{{ row['Haplotype 2'] }}</td>
          <td>{{ row['Clinical Recommendation'] }}</td>
        </tr>
      {% endfor %}
    {% else %}
      <tr>
        <td colspan="4">Inga kliniska rekommendationer baserade på genotyper hittades</td>
      </tr>
    {% endif %}
  </table>
</div>

<div class=report_div style="page-break-inside:avoid;">
  <span class="report_header">Kliniska rekomendationer baserade på interaktioner mellan genotyper</span>
  <table class='variant_table'>
    <tr>
      <th width="8%">Gen 1</th>
      <th width="8%">Gen 2</th>
      <th width="8%">Aktivitet 1</th>
      <th width="8%">Aktivitet 2</th>
      <th width="12%">Haplotyper</th>
      <th width="60%">Riktlinjer</th>
    </tr>
    {% if possible_interactions is not none %}
      {% for row in possible_interactions %}
        {% if (loop.index -1 ) in interactions_warnings %}
          <tr style="text-align:left;font-weight: bold;background-color: #FD89B3 !important;">
        {% else %}
          <tr>
        {% endif %}
          <td>{{ row['gene1'] }}</td>
          <td>{{ row['gene2'] }}</td>
          <td>{{ row['activity_1'] }}</td>
          <td>{{ row['activity_2'] }}</td>
          <td>{{ ' '.join(row['haplotypes'].split(',')|set|list) }}</td>
          <td>{{ row['Guideline'] }}</td>
        </tr>
      {% endfor %}
    {% else %}
      <tr>
        <td colspan="6">Inga kliniska rekommendationer baserade på interaktioner mellan genotyper har hittats</td>
      </tr>
    {% endif %}
  </table>
</div>

<div class=report_div style="page-break-inside:avoid;">
  <span class="report_header">Mål med lågt läsdjup</span>
  <table class='variant_table'>
    <tr>
      <th>rsID</th>
      <th>Haplotyp</th>
      <th>Position</th>
      <th>Läsjup</th>
    </tr>
    {% if low_depth_targets is not none %}
      {% for row in low_depth_targets %}
        <tr>
          <td>{{ row['rsID'] }}</td>
          <td>{{ row['Haplotype'] }}</td>
          <td>{{ row['Position'] }}</td>
          <td>{{ row['Read Depth'] }}</td>
        </tr>
      {% endfor %}
    {% else %}
      <tr>
        <td colspan="4">Alla mål har läst djup mer än {{ read_depth }}</td>
      </tr>
    {% endif %}
  </table>
</div>

<span class="report_header">Analysbeskrivning</span>
<div class="analysis_description">
  <p>
    Analysen avser somatiska detektion av varianter i samtliga 191 gener (en korresponderande hudbiopsi används som kontrollmaterial). För CEBPA undersöks även konstitutionella varianter. Vid avsaknad av kontrollmaterial undersöks endast ett begränsat antal gener enligt fördefinierade genlistor för AML (NPM1, CEBPA, FLT3), MPN (JAK2, CALR, MPN) samt KLL (TP53, NOTCH1, SF3B1). Analysen avser detektion av SNVs som förändrar aminosyrasekvensen i exon samt i regioner som påverkar splicing, små insertioner/deletioner (upp till runt 20-50 bp) samt FLT3-ITD.  Som krav för godkänd sekvens krävs generellt en medeltäckning på 1000x (1000 läsningar över en position i genomet). Då kraven på godkänd sekvens uppfylls ligger metodens känslighet på en variantallelfrekvens (VAF) på ≥ 3 %. Proverna är sekvenserade på Illumina-instrument. Somatiskt detekterade varianter klassas som Tier I, II, III eller IV enligt riktlinjer för tolkning och rapportering av sekvens varianter inom cancer (Tabell 2). [1] Tier IV varianter rapporteras inte ut.
  </p>
  {% if targets is not none %}
    <p><b>Tabell 1: Haplotyper som ingår i PGx-analysen</b></p>
    <table class="genetable">
      <tr>
        {% for target in targets %}
          <td>
            {{ targets[target] }}({{ target }})
          </td>
          {% if loop.index % 5 == 0 %}
            </tr><tr>
          {% endif %}
        {% endfor %}
      </tr>
    </table>
  {% endif %}
<p>
  <b>Referenser</b><p>
  [1] Standards and guidelines for the interpretation and reporting of sequence variants in cancer. Li et al, Journal of Molecular Diagnostics, 2017.
</p>
</div>

{% endblock %}